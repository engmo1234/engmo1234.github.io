<!DOCTYPE html>
<html>
<head>
    <title>Secure Message Sender</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { background: #7b51e3; color: white; border: none; padding: 10px 15px; border-radius: 5px; width: 100%; margin-top: 10px; cursor: pointer; }
        input, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        textarea { height: 100px; }
        .status { margin-top: 15px; padding: 10px; border-radius: 5px; display: none; }
        .success { background: #d4edda; color: #155724; display: block; }
        .error { background: #f8d7da; color: #721c24; display: block; }
        .wallet-info { margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Secure Message Sender</h1>
        
        <button id="connectWallet">Connect MetaMask</button>
        
        <div id="walletInfo" class="wallet-info" style="display:none">
            Connected: <span id="walletAddress"></span><br>
            Network: <span id="networkName"></span>
            <div id="ownerStatus" style="margin-top:10px;"></div>
        </div>
        
        <div id="messageSection" style="display:none">
            <h3>Send Message</h3>
            <label>To Address:</label>
            <input type="text" id="recipientAddress" placeholder="0x...">
            
            <label>Message:</label>
            <textarea id="messageContent" placeholder="Your message"></textarea>
            
            <button id="sendMessageBtn">Send Message</button>
            <div id="statusMessage" class="status"></div>
        </div>
    </div>

    <script>
        // CONFIGURATION - EDIT THESE VALUES
        const CONTRACT_ADDRESS = "0x266f692b696102c3637a5e06cf3337cfa166b40b"; // Replace with your contract address
        const CONTRACT_ABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "OwnableInvalidOwner",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "OwnableUnauthorizedAccount",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "bool",
				"name": "locked",
				"type": "bool"
			}
		],
		"name": "ContractLocked",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "MessageSent",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "message",
				"type": "string"
			}
		],
		"name": "sendMessage",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "toggleLock",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			}
		],
		"name": "getMessage",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "isLocked",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

        // App Code (No need to edit below)
        let web3, contract, account;
        
        async function init() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    const accounts = await web3.eth.getAccounts();
                    if (accounts.length > 0) connectWallet(accounts[0]);
                } catch (e) {
                    showStatus(e.message, 'error');
                }
            } else {
                document.getElementById('connectWallet').textContent = "Install MetaMask";
                document.getElementById('connectWallet').disabled = true;
            }
        }
        
        async function connectWallet() {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                account = accounts[0];
                contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                
                // Update UI
                document.getElementById('connectWallet').textContent = "Connected";
                document.getElementById('connectWallet').disabled = true;
                document.getElementById('walletAddress').textContent = account;
                document.getElementById('walletInfo').style.display = "block";
                
                // Check network
                const chainId = await web3.eth.getChainId();
                document.getElementById('networkName').textContent = 
                    chainId === 137 ? "Polygon Mainnet" : 
                    chainId === 80001 ? "Polygon Mumbai" : 
                    `Chain ID: ${chainId}`;
                
                // Check if owner
                const owner = await contract.methods.owner().call();
                const isOwner = owner.toLowerCase() === account.toLowerCase();
                
                if (isOwner) {
                    document.getElementById('ownerStatus').innerHTML = "<span style='color:green'>✓ You are the owner</span>";
                    document.getElementById('messageSection').style.display = "block";
                } else {
                    document.getElementById('ownerStatus').innerHTML = "<span style='color:red'>✗ Only owner can send</span>";
                }
                
                // Set up send button
                document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);
                
            } catch (e) {
                showStatus(e.message, 'error');
            }
        }
        
        async function sendMessage() {
            const recipient = document.getElementById('recipientAddress').value;
            const message = document.getElementById('messageContent').value;
            
            if (!web3.utils.isAddress(recipient)) {
                showStatus("Invalid address", 'error');
                return;
            }
            
            try {
                document.getElementById('sendMessageBtn').disabled = true;
                const tx = await contract.methods.sendMessage(recipient, message)
                    .send({ from: account });
                
                showStatus(`Message sent! TX: ${tx.transactionHash}`, 'success');
                document.getElementById('messageContent').value = "";
            } catch (e) {
                showStatus(e.message, 'error');
            } finally {
                document.getElementById('sendMessageBtn').disabled = false;
            }
        }
        
        function showStatus(msg, type) {
            const el = document.getElementById('statusMessage');
            el.textContent = msg;
            el.className = `status ${type}`;
        }
        
        // Initialize on load
        window.addEventListener('load', () => {
            init();
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
        });
    </script>
</body>
</html>