<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Engmo NFT Collection</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <style>
        :root {
            --primary: #6a11cb;
            --secondary: #2575fc;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --success: #28a745;
            --danger: #dc3545;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: #000 url('https://assets.codepen.io/13471/stars.png') repeat;
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, rgba(0,100,0,0.2) 0%, rgba(0,50,0,0.5) 100%);
            z-index: -1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
            background: rgba(0, 20, 0, 0.7);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0,255,0,0.3);
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(to right, #00ff00, #00cc00);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(0,255,0,0.5);
        }
        
        .wallet-btn {
            background: linear-gradient(to right, #00aa00, #007700);
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0,255,0,0.3);
        }
        
        .wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,255,0,0.5);
        }
        
        .wallet-btn.connected {
            background: var(--success);
        }
        
        .hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 3rem;
            text-align: center;
        }
        
        .video-container {
            width: 100%;
            max-width: 800px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 2rem;
            border: 2px solid rgba(0,255,0,0.5);
        }
        
        video {
            width: 100%;
            display: block;
        }
        
        .collection-info {
            background: rgba(0,50,0,0.3);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
            border: 1px solid rgba(0,255,0,0.2);
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 2rem 0;
        }
        
        .stat-card {
            background: rgba(0,40,0,0.4);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            min-width: 150px;
            margin: 0.5rem;
            flex: 1;
            border: 1px solid rgba(0,255,0,0.2);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 0.5rem 0;
            background: linear-gradient(to right, #00ff00, #00cc00);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .bid-section {
            background: rgba(0,50,0,0.3);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border: 1px solid rgba(0,255,0,0.2);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #00ff00;
        }
        
        input, select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 5px;
            border: 1px solid rgba(0,255,0,0.3);
            background: rgba(0,20,0,0.5);
            color: white;
            font-size: 1rem;
        }
        
        button {
            background: linear-gradient(to right, #00aa00, #007700);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 0 10px rgba(0,255,0,0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,255,0,0.5);
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .admin-section {
            background: rgba(255,0,0,0.1);
            padding: 2rem;
            border-radius: 10px;
            margin-top: 2rem;
            display: none;
            border: 1px solid rgba(255,0,0,0.3);
        }
        
        .admin-section h3 {
            color: #ff6b6b;
            margin-top: 0;
        }
        
        .bid-status {
            margin-top: 2rem;
            padding: 1rem;
            border-radius: 5px;
            display: none;
        }
        
        .success {
            background: rgba(40, 167, 69, 0.2);
            border-left: 4px solid var(--success);
        }
        
        .error {
            background: rgba(220, 53, 69, 0.2);
            border-left: 4px solid var(--danger);
        }
        
        .nft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .nft-card {
            background: rgba(0,40,0,0.4);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,255,0,0.2);
        }
        
        .nft-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,255,0,0.3);
        }
        
        .nft-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }
        
        .nft-info {
            padding: 1rem;
        }
        
        .nft-title {
            margin: 0;
            font-size: 1.2rem;
            color: #00ff00;
        }
        
        .nft-description {
            color: rgba(200,255,200,0.7);
            font-size: 0.9rem;
            margin: 0.5rem 0;
        }
        
        @media (max-width: 768px) {
            .stats {
                flex-direction: column;
            }
            
            .stat-card {
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">Engmo NFT Collection</div>
            <button id="connectWallet" class="wallet-btn">Connect Wallet</button>
        </header>
        
        <div class="hero">
            <div class="video-container">
                <video controls autoplay loop muted>
                    <source src="https://brown-nearby-junglefowl-183.mypinata.cloud/ipfs/bafybeiacpga4nqrc3uatb62k654fhft7jhia4pvgyqvqtcb4skb3ma5y4i" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            <h1>Limited Edition Video NFTs</h1>
            <p>Bid for your chance to own one of only 99 unique digital collectibles</p>
        </div>
        
        <div class="collection-info">
            <h2>About the Collection</h2>
            <p>Each EngmoShirt NFT is a unique digital collectible featuring exclusive video content AND WEBSITE DESIGN GIFT. Only 99 will ever be minted through our bidding platform.</p>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">Total Supply</div>
                    <div class="stat-value" id="totalSupply">99</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Available</div>
                    <div class="stat-value" id="availableSupply">99</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Your Bids</div>
                    <div class="stat-value" id="userBids">0</div>
                </div>
            </div>
        </div>
        
        <div id="bidStatus" class="bid-status" style="display: none;"></div>
        
        <div class="bid-section">
            <h2>Place Your Bid</h2>
            <div class="form-group">
                <label for="bidAmount">Bid Amount (MATIC)</label>
                <input type="number" id="bidAmount" placeholder="Enter amount in MATIC" step="0.01" min="0.01">
            </div>
            <button id="submitBid">Submit Bid</button>
            <button id="withdrawBid" style="margin-top: 1rem; background: var(--danger);">Withdraw Bid</button>
        </div>
        
        <div class="bid-section">
            <h2>Mint Your NFT</h2>
            <p>If your bid has been approved, you can mint your NFT here.</p>
            <button id="mintNft">Mint NFT</button>
        </div>
        
        <div id="adminSection" class="admin-section">
            <h3>Admin Controls</h3>
            <div class="form-group">
                <label for="bidderAddress">Bidder Address</label>
                <input type="text" id="bidderAddress" placeholder="Enter bidder's address">
            </div>
            <button id="approveBid">Approve Bid</button>
            <button id="withdrawFunds" style="margin-top: 1rem; background: var(--success);">Withdraw Funds</button>
        </div>
        
        <div class="collection-info">
            <h2>Your Collection</h2>
            <div class="nft-grid" id="nftGrid">
                <!-- NFTs will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // PUT ABI HERE
        const contractABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "balance",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "needed",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			}
		],
		"name": "ERC1155InsufficientBalance",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "approver",
				"type": "address"
			}
		],
		"name": "ERC1155InvalidApprover",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "idsLength",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "valuesLength",
				"type": "uint256"
			}
		],
		"name": "ERC1155InvalidArrayLength",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			}
		],
		"name": "ERC1155InvalidOperator",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			}
		],
		"name": "ERC1155InvalidReceiver",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			}
		],
		"name": "ERC1155InvalidSender",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "ERC1155MissingApprovalForAll",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "OwnableInvalidOwner",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "OwnableUnauthorizedAccount",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "approved",
				"type": "bool"
			}
		],
		"name": "ApprovalForAll",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bidder",
				"type": "address"
			}
		],
		"name": "BidApproved",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bidder",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "BidSubmitted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "FundsWithdrawn",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "minter",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "tokenId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "NFTMinted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "bidder",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "RefundIssued",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256[]",
				"name": "ids",
				"type": "uint256[]"
			},
			{
				"indexed": false,
				"internalType": "uint256[]",
				"name": "values",
				"type": "uint256[]"
			}
		],
		"name": "TransferBatch",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "TransferSingle",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "string",
				"name": "value",
				"type": "string"
			},
			{
				"indexed": true,
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			}
		],
		"name": "URI",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "UnlockableContentAccessed",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "MAX_SUPPLY",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "TOKEN_ID",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "accessUnlockableContent",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "bidder",
				"type": "address"
			}
		],
		"name": "approveBid",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "accounts",
				"type": "address[]"
			},
			{
				"internalType": "uint256[]",
				"name": "ids",
				"type": "uint256[]"
			}
		],
		"name": "balanceOfBatch",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "bids",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "approved",
				"type": "bool"
			},
			{
				"internalType": "bool",
				"name": "refunded",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getImageURI",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getUnlockablePassword",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getVideoURI",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "hasMinted",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			}
		],
		"name": "isApprovedForAll",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "mint",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256[]",
				"name": "ids",
				"type": "uint256[]"
			},
			{
				"internalType": "uint256[]",
				"name": "values",
				"type": "uint256[]"
			},
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "safeBatchTransferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			},
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "safeTransferFrom",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "operator",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "approved",
				"type": "bool"
			}
		],
		"name": "setApprovalForAll",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "submitBid",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes4",
				"name": "interfaceId",
				"type": "bytes4"
			}
		],
		"name": "supportsInterface",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalMinted",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "uri",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "withdrawBid",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
]
        
        // Replace with your Polygon contract address
        const contractAddress = "YOUR_POLYGON_CONTRACT_ADDRESS";
        
        let web3;
        let contract;
        let accounts = [];
        let isAdmin = false;
        
        // Initialize Web3 for Polygon
        async function initWeb3() {
            if (window.ethereum) {
                try {
                    // Request account access
                    accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    // Switch to Polygon network
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x89', // Polygon mainnet
                                chainName: 'Polygon Mainnet',
                                nativeCurrency: {
                                    name: 'MATIC',
                                    symbol: 'MATIC',
                                    decimals: 18
                                },
                                rpcUrls: ['https://polygon-rpc.com/'],
                                blockExplorerUrls: ['https://polygonscan.com/']
                            }]
                        });
                    } catch (switchError) {
                        // If Polygon is already added, just continue
                        if (switchError.code !== 4001) {
                            console.error("Error switching to Polygon:", switchError);
                        }
                    }
                    
                    web3 = new Web3(window.ethereum);
                    setupEventListeners();
                    checkAdminStatus();
                    updateUI();
                } catch (error) {
                    console.error("User denied account access");
                }
            } else {
                alert('Please install MetaMask to use this dApp!');
            }
        }
        
        // Setup contract instance
        function setupContract() {
            contract = new web3.eth.Contract(contractABI, contractAddress);
        }
        
        // Check if connected account is admin
        async function checkAdminStatus() {
            if (!contract) return;
            
            try {
                const owner = await contract.methods.owner().call();
                isAdmin = (owner.toLowerCase() === accounts[0].toLowerCase());
                
                if (isAdmin) {
                    document.getElementById('adminSection').style.display = 'block';
                }
            } catch (error) {
                console.error("Error checking admin status:", error);
            }
        }
        
        // Update UI with contract data
        async function updateUI() {
            if (!contract || accounts.length === 0) return;
            
            try {
                // Update supply info
                const totalMinted = await contract.methods.totalMinted().call();
                document.getElementById('availableSupply').textContent = 99 - totalMinted;
                
                // Update user bid info
                const userBid = await contract.methods.bids(accounts[0]).call();
                document.getElementById('userBids').textContent = web3.utils.fromWei(userBid.amount, 'ether') || '0';
                
                // Update wallet button
                const walletBtn = document.getElementById('connectWallet');
                walletBtn.textContent = `${accounts[0].substring(0, 6)}...${accounts[0].substring(38)}`;
                walletBtn.classList.add('connected');
                
                // Check if user can mint
                const canMint = userBid.approved && !(await contract.methods.hasMinted(accounts[0]).call());
                document.getElementById('mintNft').disabled = !canMint;
                
                // Load user's NFTs
                loadUserNFTs();
            } catch (error) {
                console.error("Error updating UI:", error);
            }
        }
        
        // Load user's owned NFTs
        async function loadUserNFTs() {
            const balance = await contract.methods.balanceOf(accounts[0], 0).call();
            const nftGrid = document.getElementById('nftGrid');
            nftGrid.innerHTML = '';
            
            if (balance > 0) {
                for (let i = 0; i < balance; i++) {
                    const nftCard = document.createElement('div');
                    nftCard.className = 'nft-card';
                    nftCard.innerHTML = `
                        <img src="https://brown-nearby-junglefowl-183.mypinata.cloud/ipfs/bafybeicdsnpkhgtmc4qlxz3rrth7xwwzrx2a5mtjaxljfetgi6ps3kp5mq" class="nft-image">
                        <div class="nft-info">
                            <h3 class="nft-title">EngmoEBSITEGIFT NFT</h3>
                            <p class="nft-description">Limited edition digital collectible</p>
                        </div>
                    `;
                    nftGrid.appendChild(nftCard);
                }
            }
        }
        
        // Show status message
        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('bidStatus');
            statusDiv.textContent = message;
            statusDiv.className = isError ? 'bid-status error' : 'bid-status success';
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Connect wallet button
            document.getElementById('connectWallet').addEventListener('click', initWeb3);
            
            // Submit bid button
            document.getElementById('submitBid').addEventListener('click', async () => {
                const amount = document.getElementById('bidAmount').value;
                if (!amount || isNaN(amount)) {
                    showStatus('Please enter a valid bid amount', true);
                    return;
                }
                
                try {
                    const weiAmount = web3.utils.toWei(amount, 'ether');
                    await contract.methods.submitBid().send({ 
                        from: accounts[0], 
                        value: weiAmount 
                    });
                    showStatus('Bid submitted successfully!');
                    updateUI();
                } catch (error) {
                    showStatus('Error submitting bid: ' + error.message, true);
                }
            });
            
            // Withdraw bid button
            document.getElementById('withdrawBid').addEventListener('click', async () => {
                try {
                    await contract.methods.withdrawBid().send({ from: accounts[0] });
                    showStatus('Bid withdrawn successfully!');
                    updateUI();
                } catch (error) {
                    showStatus('Error withdrawing bid: ' + error.message, true);
                }
            });
            
            // Mint NFT button
            document.getElementById('mintNft').addEventListener('click', async () => {
                try {
                    await contract.methods.mint().send({ from: accounts[0] });
                    showStatus('NFT minted successfully!');
                    updateUI();
                } catch (error) {
                    showStatus('Error minting NFT: ' + error.message, true);
                }
            });
            
            // Admin: Approve bid button
            document.getElementById('approveBid').addEventListener('click', async () => {
                const bidderAddress = document.getElementById('bidderAddress').value;
                if (!web3.utils.isAddress(bidderAddress)) {
                    showStatus('Please enter a valid address', true);
                    return;
                }
                
                try {
                    await contract.methods.approveBid(bidderAddress).send({ from: accounts[0] });
                    showStatus('Bid approved successfully!');
                } catch (error) {
                    showStatus('Error approving bid: ' + error.message, true);
                }
            });
            
            // Admin: Withdraw funds button
            document.getElementById('withdrawFunds').addEventListener('click', async () => {
                try {
                    await contract.methods.withdraw().send({ from: accounts[0] });
                    showStatus('Funds withdrawn successfully!');
                } catch (error) {
                    showStatus('Error withdrawing funds: ' + error.message, true);
                }
            });
        }
        
        // Initialize when page loads
        window.addEventListener('load', () => {
            initWeb3();
            setupContract();
        });
    </script>
</body>
</html>